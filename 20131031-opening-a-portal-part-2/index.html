<!DOCTYPE html>
<html>
<head>
	<title>Open a Portal and Communicate With The Other Side... (Part 2)</title>
	<script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=doxy"></script>
	<link type="text/css" rel="stylesheet" href="../common/blog.css">
</head>
<body>
	<div class="hs-migrated-cms-post df-blog">
		<div class="pull-left">
			<img class="picture"
				 src="//raw.github.com/dreamfactorysoftware/dsp-blog-posts/master/20131031-opening-a-portal-part-1/portal.jpg">
		</div>

		<section id="introduction" class="flush-left">
			<H2>Are we there yet?</H2>

			<p style="margin-top:25px;">This post picks up where part 1 left off... I apologize for the delay. My original post was too long so I split it into two parts. In
				reviewing
				the second installment, I realized that the concepts would be better conveyed through an actual application.</p>

			<p>The application is called <strong>Portal Sandbox</strong> and the full source code is available on
				<a href="https://github.com/dreamfactorysoftware/portal-sandbox" target="_blank">GitHub</a>. Go ahead and clone a copy so you can follow along. I'll wait...</p>
		</section>

		<section id="recap" class="flush-left">
			<H2>First Installment Recap & Checklist</H2>

			<p>So in <a target="_blank" href="http://blog.dreamfactory.com/blog/bid/341114/OAuth-Tutorial-Part-One">Using OAuth with the New Portal Service</a>, I introduced the
				concept of the portal.
				To recap, the new <strong>Portal</strong>
				service provides access to authenticated services and API on a per-user basis. The portal service requires that you create <strong>Providers</strong>, or endpoints
				and
				keys for a particular service. For the purposes of this blog, I chose Facebook's
				<a href="https://developers.facebook.com/docs/graph-api/" target="_blank">Graph API</a>
				as the example provider.</p>

			<p>When a user authenticates with a <strong>provider</strong>, the returned access credentials (an OAuth token in the case of Facebook) are encrypted and stored in the
				<strong>ProviderUser</strong> resource. These are accessible via the DSP's REST API using the <code>/rest/system/provider</code> and
				<code>/rest/system/provider_user</code> endpoints respectively. The following flow chart in figure 1 shows the process in broad strokes.</p>
			<figure><img style="width: 600px !important;"
						 src="figure1.png"
						 alt="//raw.github.com/dreamfactorysoftware/dsp-blog-posts/master/20131031-opening-a-portal-part-2/figure1.png">
				<figcaption>Figure 1: The basic flow</figcaption>
			</figure>

			<hr style="margin: 25px; border-color: #efefef;" />

			<p style="clear:both;">Confused? Don't be, it'll all become quite clear once we fire up the sandbox. With that said, let's recap the key concepts and make sure you've
				got
				all your ducks in a row.</p>

			<h4>Key Concepts from Part One:</h4>

			<ul>
				<li>The new <strong>Portal</strong> service provides your DSP with access to authenticated services and APIs on a per-user basis.</li>
				<li>No providers are supplied with the DSP. You must create them yourself.
					<section class="callout warning-block"><h4>Of Note...</h4>

						<p>No UI exists to manipulate providers or provider users. You need to do this through the This will be available in a future update (at the time of this
							writing the current version is
							<a href="https://github.com/dreamfactorysoftware/dsp-core" target="_blank">1.2.3</a>).</p>
					</section>
				</li>
				<li>Each call to a portal service is relayed verbatim (less any DSP-specific parameters) to the provider.
					<section class="callout changed-block"><h2>A Real-World Example</h2>

						<p>Here is an actual portal call to retrieve the current user's profile from Facebook:</p>
						<pre class="prettyprint">https://dsp-yours.cloud.dreamfactory.com/rest/portal/fbportal/<span class="str">me?app_name=admin</span></pre>
						<p>The portal service translates this call into:</p>
						<pre class="prettyprint">https://graph.facebook.com/<span class="str">me?access_token=&lt;user's token inserted here for you&gt;</span></pre>
						<p>The service makes this request, which is an HTTP GET, and returns the results:</p>
						<pre class="prettyprint">

						</pre>
					</section>
				</li>
			</ul>

			<h4>Checklist:</h4>

			<ul>
				<li>The new <strong>Portal</strong> service provides your DSP with access to authenticated services and APIs on a per-user basis.</li>
				<li>No providers are supplied with the DSP. You must create them yourself.</li>
				<li>
				</li>
			</ul>
		</section>

		<section id="portal-sandbox">
			<H2>Enter Sandbox (We're off to never never-land)</H2>

			<p>The flow here is as follows. Calling the Portal API relays your remote API request out to the appropriate provider. If there are no credentials stored for the user
				requesting the resource, most sites present a login dialog to authenticate the user making the request. The Facebook authentication dialog is show in figure 7.</p>
			<figure>
				<img src="">
				<figcaption>Figure 7: Authenticate and Authorize</figcaption>
			</figure>
			<p>Once you answer "Ok"/"Continue" to one of these login dialogs, the provider redirects back to the configured URL (this varies per service) with a
				<strong>code</strong>. This code is then exchanged for an actual
				<strong>access token</strong> which is used for all subsequent communication to the API on the authenticating users' behalf.</p>

			<p>The token and any other provider-specific information is then stored along with the user's ID and the ID of the provider in your DSP's local database. This
				information
				is in
				the
				<strong>provider user</strong> resource/table.</p>
		</section>
	</div>
</body>
</html>
